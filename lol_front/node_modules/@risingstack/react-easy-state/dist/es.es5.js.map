{"version":3,"file":"es.es5.js","sources":["../src/utils.js","../src/view.js","../src/scheduler.js","../src/batch.js","../src/store.js","../src/autoEffect.js"],"sourcesContent":["import { useState } from 'react';\n\n// try to find the global object\n// it is window in the DOM and global in NodeJS and React Native\nconst isDOM = typeof window !== 'undefined';\nconst isNative = typeof global !== 'undefined';\nexport const globalObj = isDOM\n  ? window\n  : isNative\n  ? global\n  : undefined;\n\nexport const hasHooks = typeof useState === 'function';\n","import { Component, useState, useEffect, useMemo, memo } from 'react';\nimport {\n  observe,\n  unobserve,\n  raw,\n  isObservable,\n} from '@nx-js/observer-util';\n\nimport { hasHooks } from './utils';\n\nexport let isInsideFunctionComponent = false;\nexport let isInsideClassComponentRender = false;\nexport let isInsideFunctionComponentWithoutHooks = false;\nconst COMPONENT = Symbol('owner component');\n\nfunction mapStateToStores(state) {\n  // find store properties and map them to their none observable raw value\n  // to do not trigger none static this.setState calls\n  // from the static getDerivedStateFromProps lifecycle method\n  const component = state[COMPONENT];\n  return Object.keys(component)\n    .map(key => component[key])\n    .filter(isObservable)\n    .map(raw);\n}\n\nexport function view(Comp) {\n  const isStatelessComp = !(\n    Comp.prototype && Comp.prototype.isReactComponent\n  );\n\n  let ReactiveComp;\n\n  if (isStatelessComp && hasHooks) {\n    // use a hook based reactive wrapper when we can\n    ReactiveComp = props => {\n      // use a dummy setState to update the component\n      const [, setState] = useState();\n      // create a memoized reactive wrapper of the original component (render)\n      // at the very first run of the component function\n      const render = useMemo(\n        () =>\n          observe(Comp, {\n            scheduler: () => setState({}),\n            lazy: true,\n          }),\n        // Adding the original Comp here is necessary to make React Hot Reload work\n        // it does not affect behavior otherwise\n        [Comp],\n      );\n\n      // cleanup the reactive connections after the very last render of the component\n      useEffect(() => {\n        return () => unobserve(render);\n      }, []);\n\n      // the isInsideFunctionComponent flag is used to toggle `store` behavior\n      // based on where it was called from\n      isInsideFunctionComponent = true;\n      try {\n        // run the reactive render instead of the original one\n        return render(props);\n      } finally {\n        isInsideFunctionComponent = false;\n      }\n    };\n  } else {\n    const BaseComp = isStatelessComp ? Component : Comp;\n    // a HOC which overwrites render, shouldComponentUpdate and componentWillUnmount\n    // it decides when to run the new reactive methods and when to proxy to the original methods\n    class ReactiveClassComp extends BaseComp {\n      constructor(props, context) {\n        super(props, context);\n\n        this.state = this.state || {};\n        this.state[COMPONENT] = this;\n\n        // create a reactive render for the component\n        this.render = observe(this.render, {\n          scheduler: () => this.setState({}),\n          lazy: true,\n        });\n      }\n\n      render() {\n        isInsideClassComponentRender = !isStatelessComp;\n        isInsideFunctionComponentWithoutHooks = isStatelessComp;\n        try {\n          return isStatelessComp\n            ? Comp(this.props, this.context)\n            : super.render();\n        } finally {\n          isInsideClassComponentRender = false;\n          isInsideFunctionComponentWithoutHooks = false;\n        }\n      }\n\n      // react should trigger updates on prop changes, while easyState handles store changes\n      shouldComponentUpdate(nextProps, nextState) {\n        const { props, state } = this;\n\n        // respect the case when the user defines a shouldComponentUpdate\n        if (super.shouldComponentUpdate) {\n          return super.shouldComponentUpdate(nextProps, nextState);\n        }\n\n        // return true if it is a reactive render or state changes\n        if (state !== nextState) {\n          return true;\n        }\n\n        // the component should update if any of its props shallowly changed value\n        const keys = Object.keys(props);\n        const nextKeys = Object.keys(nextProps);\n        return (\n          nextKeys.length !== keys.length ||\n          nextKeys.some(key => props[key] !== nextProps[key])\n        );\n      }\n\n      // add a custom deriveStoresFromProps lifecyle method\n      static getDerivedStateFromProps(props, state) {\n        if (super.deriveStoresFromProps) {\n          // inject all local stores and let the user mutate them directly\n          const stores = mapStateToStores(state);\n          super.deriveStoresFromProps(props, ...stores);\n        }\n        // respect user defined getDerivedStateFromProps\n        if (super.getDerivedStateFromProps) {\n          return super.getDerivedStateFromProps(props, state);\n        }\n        return null;\n      }\n\n      componentWillUnmount() {\n        // call user defined componentWillUnmount\n        if (super.componentWillUnmount) {\n          super.componentWillUnmount();\n        }\n        // clean up memory used by Easy State\n        unobserve(this.render);\n      }\n    }\n\n    ReactiveComp = ReactiveClassComp;\n  }\n\n  ReactiveComp.displayName = Comp.displayName || Comp.name;\n  // static props are inherited by class components,\n  // but have to be copied for function components\n  if (isStatelessComp) {\n    Object.keys(Comp).forEach(key => {\n      ReactiveComp[key] = Comp[key];\n    });\n  }\n\n  return isStatelessComp && hasHooks\n    ? memo(ReactiveComp)\n    : ReactiveComp;\n}\n","const taskQueue = new Set();\n\nconst scheduler = {\n  isOn: false,\n  add(task) {\n    if (scheduler.isOn) {\n      taskQueue.add(task);\n    } else {\n      task();\n    }\n  },\n  flush() {\n    taskQueue.forEach(task => task());\n    taskQueue.clear();\n  },\n  on() {\n    scheduler.isOn = true;\n  },\n  off() {\n    scheduler.isOn = false;\n  },\n};\n\nexport default scheduler;\n","/* eslint camelcase: 0 */\n\n// react-platform is set to either react-dom or react-native during test and execution\n// eslint-disable-next-line import/no-unresolved\nimport { unstable_batchedUpdates } from 'react-platform';\nimport { globalObj } from './utils';\nimport scheduler from './scheduler';\n\n// this runs the passed function and delays all re-renders\n// until the function is finished running\n// react renders are batched by unstable_batchedUpdates\n// autoEffects and other custom reactions are batched by our scheduler\nexport function batch(fn, ctx, args) {\n  // do not apply scheduler logic if it is already applied from a parent function\n  // it would flush in the middle of the parent's batch\n  if (scheduler.isOn) {\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  }\n  try {\n    scheduler.on();\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  } finally {\n    scheduler.flush();\n    scheduler.off();\n  }\n}\n\n// this creates and returns a batched version of the passed function\n// the cache is necessary to always map the same thing to the same function\n// which makes sure that addEventListener/removeEventListener pairs don't break\nconst cache = new WeakMap();\nfunction batchFn(fn) {\n  if (typeof fn !== 'function') {\n    return fn;\n  }\n  let batched = cache.get(fn);\n  if (!batched) {\n    batched = new Proxy(fn, {\n      apply(target, thisArg, args) {\n        return batch(target, thisArg, args);\n      },\n    });\n    cache.set(fn, batched);\n  }\n  return batched;\n}\n\nfunction batchMethodCallbacks(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (\n    descriptor &&\n    descriptor.writable &&\n    typeof descriptor.value === 'function'\n  ) {\n    obj[method] = new Proxy(descriptor.value, {\n      apply(target, ctx, args) {\n        return Reflect.apply(target, ctx, args.map(batchFn));\n      },\n    });\n  }\n}\n\n// batched obj.addEventListener(cb) like callbacks\nfunction batchMethodsCallbacks(obj, methods) {\n  methods.forEach(method => batchMethodCallbacks(obj, method));\n}\n\nfunction batchMethod(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (!descriptor) {\n    return;\n  }\n  const { value, writable, set, configurable } = descriptor;\n\n  if (configurable && typeof set === 'function') {\n    Object.defineProperty(obj, method, {\n      ...descriptor,\n      set: batchFn(set),\n    });\n  } else if (writable && typeof value === 'function') {\n    obj[method] = batchFn(value);\n  }\n}\n\n// batches obj.onevent = fn like calls and store methods\nexport function batchMethods(obj, methods) {\n  methods = methods || Object.getOwnPropertyNames(obj);\n  methods.forEach(method => batchMethod(obj, method));\n  return obj;\n}\n\n// do a sync batching for the most common task sources\n// this should be removed when React's own batching is improved in the future\n\n// batch timer functions\nbatchMethodsCallbacks(globalObj, [\n  'setTimeout',\n  'setInterval',\n  'requestAnimationFrame',\n  'requestIdleCallback',\n]);\n\nif (globalObj.Promise) {\n  batchMethodsCallbacks(Promise.prototype, ['then', 'catch']);\n}\n\n// Event listener batching causes an input caret jumping bug:\n// https://github.com/RisingStack/react-easy-state/issues/92.\n// This part has to be commented out to prevent that bug.\n// React batches setStates in its event listeners anyways\n// so this commenting this part out is not a huge issue.\n\n// batch addEventListener calls\n/* if (globalObj.EventTarget) {\n  batchMethodsCallbacks(EventTarget.prototype, [\n    'addEventListener',\n    'removeEventListener',\n  ]);\n} */\n\n// this batches websocket event handlers\nif (globalObj.WebSocket) {\n  batchMethods(WebSocket.prototype, [\n    'onopen',\n    'onmessage',\n    'onerror',\n    'onclose',\n  ]);\n}\n\n// HTTP event handlers are usually wrapped by Promises, which is covered above\n","import { useMemo } from 'react';\nimport { observable } from '@nx-js/observer-util';\n\nimport { batchMethods } from './batch';\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nfunction createStore(obj) {\n  return batchMethods(\n    observable(typeof obj === 'function' ? obj() : obj),\n  );\n}\n\nexport function store(obj) {\n  // do not create new versions of the store on every render\n  // if it is a local store in a function component\n  // create a memoized store at the first call instead\n  if (isInsideFunctionComponent) {\n    // useMemo is not a semantic guarantee\n    // In the future, React may choose to “forget” some previously memoized values and recalculate them on next render\n    // see this docs for more explanation: https://reactjs.org/docs/hooks-reference.html#usememo\n    return useMemo(() => createStore(obj), []);\n  }\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use state inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use state inside a render of a class component. Please create your store outside of the render function.',\n    );\n  }\n  return createStore(obj);\n}\n","import { useEffect } from 'react';\nimport { observe, unobserve } from '@nx-js/observer-util';\nimport scheduler from './scheduler';\n\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nexport function autoEffect(fn, deps = []) {\n  if (isInsideFunctionComponent) {\n    return useEffect(() => {\n      const observer = observe(fn, {\n        scheduler: () => scheduler.add(observer),\n      });\n      return () => unobserve(observer);\n    }, deps);\n  }\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use autoEffect inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use autoEffect inside a render of a class component. Please use it in the constructor or lifecycle methods instead.',\n    );\n  }\n\n  const observer = observe(fn, {\n    scheduler: () => scheduler.add(observer),\n  });\n  return observer;\n}\n\nexport { unobserve as clearEffect };\n"],"names":["isDOM","window","isNative","global","globalObj","undefined","hasHooks","useState","isInsideFunctionComponent","isInsideClassComponentRender","isInsideFunctionComponentWithoutHooks","COMPONENT","Symbol","mapStateToStores","state","component","Object","keys","map","key","filter","isObservable","raw","view","Comp","isStatelessComp","prototype","isReactComponent","ReactiveComp","props","setState","render","useMemo","observe","scheduler","lazy","useEffect","unobserve","BaseComp","Component","ReactiveClassComp","context","nextProps","nextState","nextKeys","length","some","stores","displayName","name","forEach","memo","taskQueue","Set","isOn","add","task","flush","clear","on","off","batch","fn","ctx","args","unstable_batchedUpdates","apply","cache","WeakMap","batchFn","batched","get","Proxy","target","thisArg","set","batchMethodCallbacks","obj","method","descriptor","getOwnPropertyDescriptor","writable","value","Reflect","batchMethodsCallbacks","methods","batchMethod","configurable","defineProperty","batchMethods","getOwnPropertyNames","Promise","WebSocket","createStore","observable","store","Error","autoEffect","deps","observer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA;;AACA,IAAMA,KAAK,GAAG,OAAOC,MAAP,KAAkB,WAAhC;AACA,IAAMC,QAAQ,GAAG,OAAOC,MAAP,KAAkB,WAAnC;AACO,IAAMC,SAAS,GAAGJ,KAAK,GAC1BC,MAD0B,GAE1BC,QAAQ,GACRC,MADQ,GAERE,SAJG;AAMA,IAAMC,QAAQ,GAAG,OAAOC,QAAP,KAAoB,UAArC;;ACFA,IAAIC,yBAAyB,GAAG,KAAhC;AACA,IAAIC,4BAA4B,GAAG,KAAnC;AACA,IAAIC,qCAAqC,GAAG,KAA5C;AACP,IAAMC,SAAS,GAAGC,MAAM,CAAC,iBAAD,CAAxB;;AAEA,SAASC,gBAAT,CAA0BC,KAA1B,EAAiC;AAC/B;AACA;AACA;AACA,MAAMC,SAAS,GAAGD,KAAK,CAACH,SAAD,CAAvB;AACA,SAAOK,MAAM,CAACC,IAAP,CAAYF,SAAZ,EACJG,GADI,CACA,UAAAC,GAAG;AAAA,WAAIJ,SAAS,CAACI,GAAD,CAAb;AAAA,GADH,EAEJC,MAFI,CAEGC,YAFH,EAGJH,GAHI,CAGAI,GAHA,CAAP;AAID;;AAEM,SAASC,IAAT,CAAcC,IAAd,EAAoB;AACzB,MAAMC,eAAe,GAAG,EACtBD,IAAI,CAACE,SAAL,IAAkBF,IAAI,CAACE,SAAL,CAAeC,gBADX,CAAxB;AAIA,MAAIC,YAAJ;;AAEA,MAAIH,eAAe,IAAInB,QAAvB,EAAiC;AAC/B;AACAsB,IAAAA,YAAY,GAAG,sBAAAC,KAAK,EAAI;AACtB;AADsB,sBAEDtB,QAAQ,EAFP;AAAA;AAAA,UAEbuB,QAFa;AAItB;;;AACA,UAAMC,MAAM,GAAGC,OAAO,CACpB;AAAA,eACEC,OAAO,CAACT,IAAD,EAAO;AACZU,UAAAA,SAAS,EAAE;AAAA,mBAAMJ,QAAQ,CAAC,EAAD,CAAd;AAAA,WADC;AAEZK,UAAAA,IAAI,EAAE;AAFM,SAAP,CADT;AAAA,OADoB;AAOpB;AACA,OAACX,IAAD,CARoB,CAAtB,CALsB;;AAiBtBY,MAAAA,SAAS,CAAC,YAAM;AACd,eAAO;AAAA,iBAAMC,SAAS,CAACN,MAAD,CAAf;AAAA,SAAP;AACD,OAFQ,EAEN,EAFM,CAAT,CAjBsB;AAsBtB;;AACAvB,MAAAA,yBAAyB,GAAG,IAA5B;;AACA,UAAI;AACF;AACA,eAAOuB,MAAM,CAACF,KAAD,CAAb;AACD,OAHD,SAGU;AACRrB,QAAAA,yBAAyB,GAAG,KAA5B;AACD;AACF,KA9BD;AA+BD,GAjCD,MAiCO;AACL,QAAM8B,QAAQ,GAAGb,eAAe,GAAGc,SAAH,GAAef,IAA/C,CADK;AAGL;;AAHK,QAICgB,iBAJD;AAAA;;AAKH,iCAAYX,KAAZ,EAAmBY,OAAnB,EAA4B;AAAA;;AAAA;;AAC1B,+FAAMZ,KAAN,EAAaY,OAAb;AAEA,cAAK3B,KAAL,GAAa,MAAKA,KAAL,IAAc,EAA3B;AACA,cAAKA,KAAL,CAAWH,SAAX,kCAJ0B;;AAO1B,cAAKoB,MAAL,GAAcE,OAAO,CAAC,MAAKF,MAAN,EAAc;AACjCG,UAAAA,SAAS,EAAE;AAAA,mBAAM,MAAKJ,QAAL,CAAc,EAAd,CAAN;AAAA,WADsB;AAEjCK,UAAAA,IAAI,EAAE;AAF2B,SAAd,CAArB;AAP0B;AAW3B;;AAhBE;AAAA;AAAA,iCAkBM;AACP1B,UAAAA,4BAA4B,GAAG,CAACgB,eAAhC;AACAf,UAAAA,qCAAqC,GAAGe,eAAxC;;AACA,cAAI;AACF,mBAAOA,eAAe,GAClBD,IAAI,CAAC,KAAKK,KAAN,EAAa,KAAKY,OAAlB,CADc,gFAAtB;AAGD,WAJD,SAIU;AACRhC,YAAAA,4BAA4B,GAAG,KAA/B;AACAC,YAAAA,qCAAqC,GAAG,KAAxC;AACD;AACF,SA7BE;;AAAA;AAAA;AAAA,8CAgCmBgC,SAhCnB,EAgC8BC,SAhC9B,EAgCyC;AAAA,cAClCd,KADkC,GACjB,IADiB,CAClCA,KADkC;AAAA,cAC3Bf,KAD2B,GACjB,IADiB,CAC3BA,KAD2B;;AAI1C,iGAAiC;AAC/B,gHAAmC4B,SAAnC,EAA8CC,SAA9C;AACD,WANyC;;;AAS1C,cAAI7B,KAAK,KAAK6B,SAAd,EAAyB;AACvB,mBAAO,IAAP;AACD,WAXyC;;;AAc1C,cAAM1B,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYY,KAAZ,CAAb;AACA,cAAMe,QAAQ,GAAG5B,MAAM,CAACC,IAAP,CAAYyB,SAAZ,CAAjB;AACA,iBACEE,QAAQ,CAACC,MAAT,KAAoB5B,IAAI,CAAC4B,MAAzB,IACAD,QAAQ,CAACE,IAAT,CAAc,UAAA3B,GAAG;AAAA,mBAAIU,KAAK,CAACV,GAAD,CAAL,KAAeuB,SAAS,CAACvB,GAAD,CAA5B;AAAA,WAAjB,CAFF;AAID,SApDE;;AAAA;AAAA;AAAA,+CAoEoB;AACrB;AACA,gGAAgC;AAC9B;AACD,WAJoB;;;AAMrBkB,UAAAA,SAAS,CAAC,KAAKN,MAAN,CAAT;AACD;AA3EE;AAAA;AAAA,iDAuD6BF,KAvD7B,EAuDoCf,KAvDpC,EAuD2C;AAC5C,uFAAiC;AAAA;;AAC/B;AACA,gBAAMiC,MAAM,GAAGlC,gBAAgB,CAACC,KAAD,CAA/B;;AACA,uHAA4Be,KAA5B,4BAAsCkB,MAAtC;AACD,WAL2C;;;AAO5C,0FAAoC;AAClC,yGAAsClB,KAAtC,EAA6Cf,KAA7C;AACD;;AACD,iBAAO,IAAP;AACD;AAlEE;;AAAA;AAAA,MAI2BwB,QAJ3B;;AA8ELV,IAAAA,YAAY,GAAGY,iBAAf;AACD;;AAEDZ,EAAAA,YAAY,CAACoB,WAAb,GAA2BxB,IAAI,CAACwB,WAAL,IAAoBxB,IAAI,CAACyB,IAApD,CAzHyB;AA2HzB;;AACA,MAAIxB,eAAJ,EAAqB;AACnBT,IAAAA,MAAM,CAACC,IAAP,CAAYO,IAAZ,EAAkB0B,OAAlB,CAA0B,UAAA/B,GAAG,EAAI;AAC/BS,MAAAA,YAAY,CAACT,GAAD,CAAZ,GAAoBK,IAAI,CAACL,GAAD,CAAxB;AACD,KAFD;AAGD;;AAED,SAAOM,eAAe,IAAInB,QAAnB,GACH6C,IAAI,CAACvB,YAAD,CADD,GAEHA,YAFJ;AAGD;;AC/JD,IAAMwB,SAAS,GAAG,IAAIC,GAAJ,EAAlB;AAEA,IAAMnB,SAAS,GAAG;AAChBoB,EAAAA,IAAI,EAAE,KADU;AAEhBC,EAAAA,GAFgB,eAEZC,IAFY,EAEN;AACR,QAAItB,SAAS,CAACoB,IAAd,EAAoB;AAClBF,MAAAA,SAAS,CAACG,GAAV,CAAcC,IAAd;AACD,KAFD,MAEO;AACLA,MAAAA,IAAI;AACL;AACF,GARe;AAShBC,EAAAA,KATgB,mBASR;AACNL,IAAAA,SAAS,CAACF,OAAV,CAAkB,UAAAM,IAAI;AAAA,aAAIA,IAAI,EAAR;AAAA,KAAtB;AACAJ,IAAAA,SAAS,CAACM,KAAV;AACD,GAZe;AAahBC,EAAAA,EAbgB,gBAaX;AACHzB,IAAAA,SAAS,CAACoB,IAAV,GAAiB,IAAjB;AACD,GAfe;AAgBhBM,EAAAA,GAhBgB,iBAgBV;AACJ1B,IAAAA,SAAS,CAACoB,IAAV,GAAiB,KAAjB;AACD;AAlBe,CAAlB;;ACOA;AACA;AACA;;AACO,SAASO,KAAT,CAAeC,EAAf,EAAmBC,GAAnB,EAAwBC,IAAxB,EAA8B;AACnC;AACA;AACA,MAAI9B,SAAS,CAACoB,IAAd,EAAoB;AAClB,WAAOW,uBAAuB,CAAC;AAAA,aAAMH,EAAE,CAACI,KAAH,CAASH,GAAT,EAAcC,IAAd,CAAN;AAAA,KAAD,CAA9B;AACD;;AACD,MAAI;AACF9B,IAAAA,SAAS,CAACyB,EAAV;AACA,WAAOM,uBAAuB,CAAC;AAAA,aAAMH,EAAE,CAACI,KAAH,CAASH,GAAT,EAAcC,IAAd,CAAN;AAAA,KAAD,CAA9B;AACD,GAHD,SAGU;AACR9B,IAAAA,SAAS,CAACuB,KAAV;AACAvB,IAAAA,SAAS,CAAC0B,GAAV;AACD;AACF;AAGD;AACA;;AACA,IAAMO,KAAK,GAAG,IAAIC,OAAJ,EAAd;;AACA,SAASC,OAAT,CAAiBP,EAAjB,EAAqB;AACnB,MAAI,OAAOA,EAAP,KAAc,UAAlB,EAA8B;AAC5B,WAAOA,EAAP;AACD;;AACD,MAAIQ,OAAO,GAAGH,KAAK,CAACI,GAAN,CAAUT,EAAV,CAAd;;AACA,MAAI,CAACQ,OAAL,EAAc;AACZA,IAAAA,OAAO,GAAG,IAAIE,KAAJ,CAAUV,EAAV,EAAc;AACtBI,MAAAA,KADsB,iBAChBO,MADgB,EACRC,OADQ,EACCV,IADD,EACO;AAC3B,eAAOH,KAAK,CAACY,MAAD,EAASC,OAAT,EAAkBV,IAAlB,CAAZ;AACD;AAHqB,KAAd,CAAV;AAKAG,IAAAA,KAAK,CAACQ,GAAN,CAAUb,EAAV,EAAcQ,OAAd;AACD;;AACD,SAAOA,OAAP;AACD;;AAED,SAASM,oBAAT,CAA8BC,GAA9B,EAAmCC,MAAnC,EAA2C;AACzC,MAAMC,UAAU,GAAG/D,MAAM,CAACgE,wBAAP,CAAgCH,GAAhC,EAAqCC,MAArC,CAAnB;;AACA,MACEC,UAAU,IACVA,UAAU,CAACE,QADX,IAEA,OAAOF,UAAU,CAACG,KAAlB,KAA4B,UAH9B,EAIE;AACAL,IAAAA,GAAG,CAACC,MAAD,CAAH,GAAc,IAAIN,KAAJ,CAAUO,UAAU,CAACG,KAArB,EAA4B;AACxChB,MAAAA,KADwC,iBAClCO,MADkC,EAC1BV,GAD0B,EACrBC,IADqB,EACf;AACvB,eAAOmB,OAAO,CAACjB,KAAR,CAAcO,MAAd,EAAsBV,GAAtB,EAA2BC,IAAI,CAAC9C,GAAL,CAASmD,OAAT,CAA3B,CAAP;AACD;AAHuC,KAA5B,CAAd;AAKD;AACF;;;AAGD,SAASe,qBAAT,CAA+BP,GAA/B,EAAoCQ,OAApC,EAA6C;AAC3CA,EAAAA,OAAO,CAACnC,OAAR,CAAgB,UAAA4B,MAAM;AAAA,WAAIF,oBAAoB,CAACC,GAAD,EAAMC,MAAN,CAAxB;AAAA,GAAtB;AACD;;AAED,SAASQ,WAAT,CAAqBT,GAArB,EAA0BC,MAA1B,EAAkC;AAChC,MAAMC,UAAU,GAAG/D,MAAM,CAACgE,wBAAP,CAAgCH,GAAhC,EAAqCC,MAArC,CAAnB;;AACA,MAAI,CAACC,UAAL,EAAiB;AACf;AACD;;AAJ+B,MAKxBG,KALwB,GAKeH,UALf,CAKxBG,KALwB;AAAA,MAKjBD,QALiB,GAKeF,UALf,CAKjBE,QALiB;AAAA,MAKPN,GALO,GAKeI,UALf,CAKPJ,GALO;AAAA,MAKFY,YALE,GAKeR,UALf,CAKFQ,YALE;;AAOhC,MAAIA,YAAY,IAAI,OAAOZ,GAAP,KAAe,UAAnC,EAA+C;AAC7C3D,IAAAA,MAAM,CAACwE,cAAP,CAAsBX,GAAtB,EAA2BC,MAA3B,qBACKC,UADL;AAEEJ,MAAAA,GAAG,EAAEN,OAAO,CAACM,GAAD;AAFd;AAID,GALD,MAKO,IAAIM,QAAQ,IAAI,OAAOC,KAAP,KAAiB,UAAjC,EAA6C;AAClDL,IAAAA,GAAG,CAACC,MAAD,CAAH,GAAcT,OAAO,CAACa,KAAD,CAArB;AACD;AACF;;;AAGM,SAASO,YAAT,CAAsBZ,GAAtB,EAA2BQ,OAA3B,EAAoC;AACzCA,EAAAA,OAAO,GAAGA,OAAO,IAAIrE,MAAM,CAAC0E,mBAAP,CAA2Bb,GAA3B,CAArB;AACAQ,EAAAA,OAAO,CAACnC,OAAR,CAAgB,UAAA4B,MAAM;AAAA,WAAIQ,WAAW,CAACT,GAAD,EAAMC,MAAN,CAAf;AAAA,GAAtB;AACA,SAAOD,GAAP;AACD;AAGD;AAEA;;AACAO,qBAAqB,CAAChF,SAAD,EAAY,CAC/B,YAD+B,EAE/B,aAF+B,EAG/B,uBAH+B,EAI/B,qBAJ+B,CAAZ,CAArB;;AAOA,IAAIA,SAAS,CAACuF,OAAd,EAAuB;AACrBP,EAAAA,qBAAqB,CAACO,OAAO,CAACjE,SAAT,EAAoB,CAAC,MAAD,EAAS,OAAT,CAApB,CAArB;AACD;AAGD;AACA;AACA;AACA;AAEA;;AACA;;;;;;AAOA;;;AACA,IAAItB,SAAS,CAACwF,SAAd,EAAyB;AACvBH,EAAAA,YAAY,CAACG,SAAS,CAAClE,SAAX,EAAsB,CAChC,QADgC,EAEhC,WAFgC,EAGhC,SAHgC,EAIhC,SAJgC,CAAtB,CAAZ;AAMD;;ACtHD,SAASmE,WAAT,CAAqBhB,GAArB,EAA0B;AACxB,SAAOY,YAAY,CACjBK,UAAU,CAAC,OAAOjB,GAAP,KAAe,UAAf,GAA4BA,GAAG,EAA/B,GAAoCA,GAArC,CADO,CAAnB;AAGD;;AAEM,SAASkB,KAAT,CAAelB,GAAf,EAAoB;AACzB;AACA;AACA;AACA,MAAIrE,yBAAJ,EAA+B;AAC7B;AACA;AACA;AACA,WAAOwB,OAAO,CAAC;AAAA,aAAM6D,WAAW,CAAChB,GAAD,CAAjB;AAAA,KAAD,EAAyB,EAAzB,CAAd;AACD;;AACD,MAAInE,qCAAJ,EAA2C;AACzC,UAAM,IAAIsF,KAAJ,CACJ,+JADI,CAAN;AAGD;;AACD,MAAIvF,4BAAJ,EAAkC;AAChC,UAAM,IAAIuF,KAAJ,CACJ,qHADI,CAAN;AAGD;;AACD,SAAOH,WAAW,CAAChB,GAAD,CAAlB;AACD;;AC3BM,SAASoB,UAAT,CAAoBnC,EAApB,EAAmC;AAAA,MAAXoC,IAAW,uEAAJ,EAAI;;AACxC,MAAI1F,yBAAJ,EAA+B;AAC7B,WAAO4B,SAAS,CAAC,YAAM;AACrB,UAAM+D,QAAQ,GAAGlE,OAAO,CAAC6B,EAAD,EAAK;AAC3B5B,QAAAA,SAAS,EAAE;AAAA,iBAAMA,SAAS,CAACqB,GAAV,CAAc4C,QAAd,CAAN;AAAA;AADgB,OAAL,CAAxB;AAGA,aAAO;AAAA,eAAM9D,SAAS,CAAC8D,QAAD,CAAf;AAAA,OAAP;AACD,KALe,EAKbD,IALa,CAAhB;AAMD;;AACD,MAAIxF,qCAAJ,EAA2C;AACzC,UAAM,IAAIsF,KAAJ,CACJ,oKADI,CAAN;AAGD;;AACD,MAAIvF,4BAAJ,EAAkC;AAChC,UAAM,IAAIuF,KAAJ,CACJ,gIADI,CAAN;AAGD;;AAED,MAAMG,QAAQ,GAAGlE,OAAO,CAAC6B,EAAD,EAAK;AAC3B5B,IAAAA,SAAS,EAAE;AAAA,aAAMA,SAAS,CAACqB,GAAV,CAAc4C,QAAd,CAAN;AAAA;AADgB,GAAL,CAAxB;AAGA,SAAOA,QAAP;AACD;;;;"}