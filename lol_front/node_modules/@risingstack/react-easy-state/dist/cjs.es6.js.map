{"version":3,"file":"cjs.es6.js","sources":["../src/utils.js","../src/view.js","../src/scheduler.js","../src/batch.js","../src/store.js","../src/autoEffect.js"],"sourcesContent":["import { useState } from 'react';\n\n// try to find the global object\n// it is window in the DOM and global in NodeJS and React Native\nconst isDOM = typeof window !== 'undefined';\nconst isNative = typeof global !== 'undefined';\nexport const globalObj = isDOM\n  ? window\n  : isNative\n  ? global\n  : undefined;\n\nexport const hasHooks = typeof useState === 'function';\n","import { Component, useState, useEffect, useMemo, memo } from 'react';\nimport {\n  observe,\n  unobserve,\n  raw,\n  isObservable,\n} from '@nx-js/observer-util';\n\nimport { hasHooks } from './utils';\n\nexport let isInsideFunctionComponent = false;\nexport let isInsideClassComponentRender = false;\nexport let isInsideFunctionComponentWithoutHooks = false;\nconst COMPONENT = Symbol('owner component');\n\nfunction mapStateToStores(state) {\n  // find store properties and map them to their none observable raw value\n  // to do not trigger none static this.setState calls\n  // from the static getDerivedStateFromProps lifecycle method\n  const component = state[COMPONENT];\n  return Object.keys(component)\n    .map(key => component[key])\n    .filter(isObservable)\n    .map(raw);\n}\n\nexport function view(Comp) {\n  const isStatelessComp = !(\n    Comp.prototype && Comp.prototype.isReactComponent\n  );\n\n  let ReactiveComp;\n\n  if (isStatelessComp && hasHooks) {\n    // use a hook based reactive wrapper when we can\n    ReactiveComp = props => {\n      // use a dummy setState to update the component\n      const [, setState] = useState();\n      // create a memoized reactive wrapper of the original component (render)\n      // at the very first run of the component function\n      const render = useMemo(\n        () =>\n          observe(Comp, {\n            scheduler: () => setState({}),\n            lazy: true,\n          }),\n        // Adding the original Comp here is necessary to make React Hot Reload work\n        // it does not affect behavior otherwise\n        [Comp],\n      );\n\n      // cleanup the reactive connections after the very last render of the component\n      useEffect(() => {\n        return () => unobserve(render);\n      }, []);\n\n      // the isInsideFunctionComponent flag is used to toggle `store` behavior\n      // based on where it was called from\n      isInsideFunctionComponent = true;\n      try {\n        // run the reactive render instead of the original one\n        return render(props);\n      } finally {\n        isInsideFunctionComponent = false;\n      }\n    };\n  } else {\n    const BaseComp = isStatelessComp ? Component : Comp;\n    // a HOC which overwrites render, shouldComponentUpdate and componentWillUnmount\n    // it decides when to run the new reactive methods and when to proxy to the original methods\n    class ReactiveClassComp extends BaseComp {\n      constructor(props, context) {\n        super(props, context);\n\n        this.state = this.state || {};\n        this.state[COMPONENT] = this;\n\n        // create a reactive render for the component\n        this.render = observe(this.render, {\n          scheduler: () => this.setState({}),\n          lazy: true,\n        });\n      }\n\n      render() {\n        isInsideClassComponentRender = !isStatelessComp;\n        isInsideFunctionComponentWithoutHooks = isStatelessComp;\n        try {\n          return isStatelessComp\n            ? Comp(this.props, this.context)\n            : super.render();\n        } finally {\n          isInsideClassComponentRender = false;\n          isInsideFunctionComponentWithoutHooks = false;\n        }\n      }\n\n      // react should trigger updates on prop changes, while easyState handles store changes\n      shouldComponentUpdate(nextProps, nextState) {\n        const { props, state } = this;\n\n        // respect the case when the user defines a shouldComponentUpdate\n        if (super.shouldComponentUpdate) {\n          return super.shouldComponentUpdate(nextProps, nextState);\n        }\n\n        // return true if it is a reactive render or state changes\n        if (state !== nextState) {\n          return true;\n        }\n\n        // the component should update if any of its props shallowly changed value\n        const keys = Object.keys(props);\n        const nextKeys = Object.keys(nextProps);\n        return (\n          nextKeys.length !== keys.length ||\n          nextKeys.some(key => props[key] !== nextProps[key])\n        );\n      }\n\n      // add a custom deriveStoresFromProps lifecyle method\n      static getDerivedStateFromProps(props, state) {\n        if (super.deriveStoresFromProps) {\n          // inject all local stores and let the user mutate them directly\n          const stores = mapStateToStores(state);\n          super.deriveStoresFromProps(props, ...stores);\n        }\n        // respect user defined getDerivedStateFromProps\n        if (super.getDerivedStateFromProps) {\n          return super.getDerivedStateFromProps(props, state);\n        }\n        return null;\n      }\n\n      componentWillUnmount() {\n        // call user defined componentWillUnmount\n        if (super.componentWillUnmount) {\n          super.componentWillUnmount();\n        }\n        // clean up memory used by Easy State\n        unobserve(this.render);\n      }\n    }\n\n    ReactiveComp = ReactiveClassComp;\n  }\n\n  ReactiveComp.displayName = Comp.displayName || Comp.name;\n  // static props are inherited by class components,\n  // but have to be copied for function components\n  if (isStatelessComp) {\n    Object.keys(Comp).forEach(key => {\n      ReactiveComp[key] = Comp[key];\n    });\n  }\n\n  return isStatelessComp && hasHooks\n    ? memo(ReactiveComp)\n    : ReactiveComp;\n}\n","const taskQueue = new Set();\n\nconst scheduler = {\n  isOn: false,\n  add(task) {\n    if (scheduler.isOn) {\n      taskQueue.add(task);\n    } else {\n      task();\n    }\n  },\n  flush() {\n    taskQueue.forEach(task => task());\n    taskQueue.clear();\n  },\n  on() {\n    scheduler.isOn = true;\n  },\n  off() {\n    scheduler.isOn = false;\n  },\n};\n\nexport default scheduler;\n","/* eslint camelcase: 0 */\n\n// react-platform is set to either react-dom or react-native during test and execution\n// eslint-disable-next-line import/no-unresolved\nimport { unstable_batchedUpdates } from 'react-platform';\nimport { globalObj } from './utils';\nimport scheduler from './scheduler';\n\n// this runs the passed function and delays all re-renders\n// until the function is finished running\n// react renders are batched by unstable_batchedUpdates\n// autoEffects and other custom reactions are batched by our scheduler\nexport function batch(fn, ctx, args) {\n  // do not apply scheduler logic if it is already applied from a parent function\n  // it would flush in the middle of the parent's batch\n  if (scheduler.isOn) {\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  }\n  try {\n    scheduler.on();\n    return unstable_batchedUpdates(() => fn.apply(ctx, args));\n  } finally {\n    scheduler.flush();\n    scheduler.off();\n  }\n}\n\n// this creates and returns a batched version of the passed function\n// the cache is necessary to always map the same thing to the same function\n// which makes sure that addEventListener/removeEventListener pairs don't break\nconst cache = new WeakMap();\nfunction batchFn(fn) {\n  if (typeof fn !== 'function') {\n    return fn;\n  }\n  let batched = cache.get(fn);\n  if (!batched) {\n    batched = new Proxy(fn, {\n      apply(target, thisArg, args) {\n        return batch(target, thisArg, args);\n      },\n    });\n    cache.set(fn, batched);\n  }\n  return batched;\n}\n\nfunction batchMethodCallbacks(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (\n    descriptor &&\n    descriptor.writable &&\n    typeof descriptor.value === 'function'\n  ) {\n    obj[method] = new Proxy(descriptor.value, {\n      apply(target, ctx, args) {\n        return Reflect.apply(target, ctx, args.map(batchFn));\n      },\n    });\n  }\n}\n\n// batched obj.addEventListener(cb) like callbacks\nfunction batchMethodsCallbacks(obj, methods) {\n  methods.forEach(method => batchMethodCallbacks(obj, method));\n}\n\nfunction batchMethod(obj, method) {\n  const descriptor = Object.getOwnPropertyDescriptor(obj, method);\n  if (!descriptor) {\n    return;\n  }\n  const { value, writable, set, configurable } = descriptor;\n\n  if (configurable && typeof set === 'function') {\n    Object.defineProperty(obj, method, {\n      ...descriptor,\n      set: batchFn(set),\n    });\n  } else if (writable && typeof value === 'function') {\n    obj[method] = batchFn(value);\n  }\n}\n\n// batches obj.onevent = fn like calls and store methods\nexport function batchMethods(obj, methods) {\n  methods = methods || Object.getOwnPropertyNames(obj);\n  methods.forEach(method => batchMethod(obj, method));\n  return obj;\n}\n\n// do a sync batching for the most common task sources\n// this should be removed when React's own batching is improved in the future\n\n// batch timer functions\nbatchMethodsCallbacks(globalObj, [\n  'setTimeout',\n  'setInterval',\n  'requestAnimationFrame',\n  'requestIdleCallback',\n]);\n\nif (globalObj.Promise) {\n  batchMethodsCallbacks(Promise.prototype, ['then', 'catch']);\n}\n\n// Event listener batching causes an input caret jumping bug:\n// https://github.com/RisingStack/react-easy-state/issues/92.\n// This part has to be commented out to prevent that bug.\n// React batches setStates in its event listeners anyways\n// so this commenting this part out is not a huge issue.\n\n// batch addEventListener calls\n/* if (globalObj.EventTarget) {\n  batchMethodsCallbacks(EventTarget.prototype, [\n    'addEventListener',\n    'removeEventListener',\n  ]);\n} */\n\n// this batches websocket event handlers\nif (globalObj.WebSocket) {\n  batchMethods(WebSocket.prototype, [\n    'onopen',\n    'onmessage',\n    'onerror',\n    'onclose',\n  ]);\n}\n\n// HTTP event handlers are usually wrapped by Promises, which is covered above\n","import { useMemo } from 'react';\nimport { observable } from '@nx-js/observer-util';\n\nimport { batchMethods } from './batch';\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nfunction createStore(obj) {\n  return batchMethods(\n    observable(typeof obj === 'function' ? obj() : obj),\n  );\n}\n\nexport function store(obj) {\n  // do not create new versions of the store on every render\n  // if it is a local store in a function component\n  // create a memoized store at the first call instead\n  if (isInsideFunctionComponent) {\n    // useMemo is not a semantic guarantee\n    // In the future, React may choose to “forget” some previously memoized values and recalculate them on next render\n    // see this docs for more explanation: https://reactjs.org/docs/hooks-reference.html#usememo\n    return useMemo(() => createStore(obj), []);\n  }\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use state inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use state inside a render of a class component. Please create your store outside of the render function.',\n    );\n  }\n  return createStore(obj);\n}\n","import { useEffect } from 'react';\nimport { observe, unobserve } from '@nx-js/observer-util';\nimport scheduler from './scheduler';\n\nimport {\n  isInsideFunctionComponent,\n  isInsideClassComponentRender,\n  isInsideFunctionComponentWithoutHooks,\n} from './view';\n\nexport function autoEffect(fn, deps = []) {\n  if (isInsideFunctionComponent) {\n    return useEffect(() => {\n      const observer = observe(fn, {\n        scheduler: () => scheduler.add(observer),\n      });\n      return () => unobserve(observer);\n    }, deps);\n  }\n  if (isInsideFunctionComponentWithoutHooks) {\n    throw new Error(\n      'You cannot use autoEffect inside a function component with a pre-hooks version of React. Please update your React version to at least v16.8.0 to use this feature.',\n    );\n  }\n  if (isInsideClassComponentRender) {\n    throw new Error(\n      'You cannot use autoEffect inside a render of a class component. Please use it in the constructor or lifecycle methods instead.',\n    );\n  }\n\n  const observer = observe(fn, {\n    scheduler: () => scheduler.add(observer),\n  });\n  return observer;\n}\n\nexport { unobserve as clearEffect };\n"],"names":["isDOM","window","isNative","global","globalObj","undefined","hasHooks","useState","isInsideFunctionComponent","isInsideClassComponentRender","isInsideFunctionComponentWithoutHooks","COMPONENT","Symbol","mapStateToStores","state","component","Object","keys","map","key","filter","isObservable","raw","view","Comp","isStatelessComp","prototype","isReactComponent","ReactiveComp","props","setState","render","useMemo","observe","scheduler","lazy","useEffect","unobserve","BaseComp","Component","ReactiveClassComp","constructor","context","shouldComponentUpdate","nextProps","nextState","nextKeys","length","some","getDerivedStateFromProps","deriveStoresFromProps","stores","componentWillUnmount","displayName","name","forEach","memo","taskQueue","Set","isOn","add","task","flush","clear","on","off","batch","fn","ctx","args","unstable_batchedUpdates","apply","cache","WeakMap","batchFn","batched","get","Proxy","target","thisArg","set","batchMethodCallbacks","obj","method","descriptor","getOwnPropertyDescriptor","writable","value","Reflect","batchMethodsCallbacks","methods","batchMethod","configurable","defineProperty","batchMethods","getOwnPropertyNames","Promise","WebSocket","createStore","observable","store","Error","autoEffect","deps","observer"],"mappings":"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"}